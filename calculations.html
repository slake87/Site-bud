<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ | –ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="styles/style6.css">
</head>
<body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–µ –º–µ–Ω—é -->
    <header class="dashboard-header">
        <nav class="nav-menu">
            <ul class="nav-list">
                <li><a href="dashboard.html" class="nav-link">–ü—Ä–æ—î–∫—Ç–∏</a></li>
                <li><a href="materials.html" class="nav-link">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</a></li>
                <li><a href="calculation.html" class="nav-link active">–†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏</a></li>
                <li><a href="suppliers.html" class="nav-link">–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏</a></li>
            </ul>
        </nav>
        <div class="user-panel">
            <button class="profile" onclick="window.location.href='profile.html'">–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</button>
            <span class="username">–ü—Ä–∏–≤—ñ—Ç, –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á!</span>
            <button class="logout-btn" onclick="window.location.href='login.html'">–í–∏—Ö—ñ–¥</button>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–∏–π –≤–º—ñ—Å—Ç -->
    <main class="dashboard-main">
        <div class="section-header">
            <h2 class="section-title">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤</h2>
        </div>
        
        <div class="calculation-container">
            <!-- –õ—ñ–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –í–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö -->
            <div class="input-section">
                <div class="calculation-block">
                    <h3 class="block-title">
                        <span>üè†</span> –ü–æ–∫—Ä—ñ–≤–ª—è (–¥–∞—Ö)
                    </h3>
                    <div class="input-group">
                        <label for="roof-price">–¶—ñ–Ω–∞ –∑–∞ –º¬≤ (–≥—Ä–Ω):</label>
                        <input type="number" id="roof-price" min="0" step="0.01" value="">
                    </div>
                    <div class="input-group">
                        <label for="roof-area">–ü–ª–æ—â–∞ –ø–æ–∫—Ä—ñ–≤–ª—ñ (–º¬≤):</label>
                        <input type="number" id="roof-area" min="0" step="0.1" value="">
                    </div>
                </div>
                
                <div class="calculation-block">
                    <h3 class="block-title">
                        <span>üß±</span> –°—Ç—ñ–Ω–∏ (—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞)
                    </h3>
                    <div class="input-group">
                        <label for="walls-price">–¶—ñ–Ω–∞ –∑–∞ –º¬≤ (–≥—Ä–Ω):</label>
                        <input type="number" id="walls-price" min="0" step="0.01" value="">
                    </div>
                    <div class="input-group">
                        <label for="walls-area">–ü–ª–æ—â–∞ —Å—Ç—ñ–Ω (–º¬≤):</label>
                        <input type="number" id="walls-area" min="0" step="0.1" value="">
                    </div>
                </div>
                
                <div class="calculation-block">
                    <h3 class="block-title">
                        <span>üî≥</span> –ü—ñ–¥–ª–æ–≥–∞
                    </h3>
                    <div class="input-group">
                        <label for="floor-price">–¶—ñ–Ω–∞ –∑–∞ –º¬≤ (–≥—Ä–Ω):</label>
                        <input type="number" id="floor-price" min="0" step="0.01" value="">
                    </div>
                    <div class="input-group">
                        <label for="floor-area">–ü–ª–æ—â–∞ –ø—ñ–¥–ª–æ–≥–∏ (–º¬≤):</label>
                        <input type="number" id="floor-area" min="0" step="0.1" value="">
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞: –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è -->
            <div class="result-section">
                <h3 class="block-title">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</h3>
                
                <div class="result-item">
                    <span>–ü–æ–∫—Ä—ñ–≤–ª—è (–¥–∞—Ö):</span>
                    <span class="cost-value" id="roof-result"></span>
                </div>
                
                <div class="result-item">
                    <span>–°—Ç—ñ–Ω–∏ (—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞):</span>
                    <span class="cost-value" id="walls-result"></span>
                </div>
                
                <div class="result-item">
                    <span>–ü—ñ–¥–ª–æ–≥–∞:</span>
                    <span class="cost-value" id="floor-result"></span>
                </div>
                
                <div class="result-item total">
                    <span>–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:</span>
                    <span class="cost-value" id="total-result"></span>
                </div>
                
                <div class="visualization">
                    <h4 class="visualization-title">–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏—Ç—Ä–∞—Ç</h4>
                    <div class="cost-bars">
                        <div class="cost-bar" id="roof-bar" style="height: 120px;">
                            <div class="cost-bar-value"></div>
                            <div class="cost-bar-label">–ü–æ–∫—Ä—ñ–≤–ª—è</div>
                        </div>
                        <div class="cost-bar" id="walls-bar" style="height: 200px;">
                            <div class="cost-bar-value"></div>
                            <div class="cost-bar-label">–°—Ç—ñ–Ω–∏</div>
                        </div>
                        <div class="cost-bar" id="floor-bar" style="height: 109px;">
                            <div class="cost-bar-value"></div>
                            <div class="cost-bar-label">–ü—ñ–¥–ª–æ–≥–∞</div>
                        </div>
                    </div>
                </div>
                
                <div class="save-container">
                    <button class="save-btn" id="save-calculation">
                        <span>üíæ</span> –ü—ñ–¥–ø–∏—Å–∞—Ç–∏ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏
                    </button>
                    <button class="export-btn" id="export-excel">
                        <span>üìä</span> –ß–∏—Å—Ç–∏–π –ï–∫—Å–ø–æ—Ä—Ç –≤ Excel
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è -->
    <div class="modal" id="save-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ—à—Ç–æ—Ä–∏—Å</h3>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-input-group">
                <label for="estimate-name">–ù–∞–∑–≤–∞ –∫–æ—à—Ç–æ—Ä–∏—Å—É:</label>
                <input type="text" id="estimate-name" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ö–æ—Ç–µ–¥–∂ '–°–æ–Ω—è—á–Ω–∏–π'">
            </div>
            <div class="modal-input-group">
                <label for="estimate-date">–î–∞—Ç–∞:</label>
                <input type="date" id="estimate-date">
            </div>
            <div class="modal-buttons">
                <button class="export-btn" id="export-only">–ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
                <button class="save-btn" id="save-and-export">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
        const roofPrice = document.getElementById('roof-price');
        const roofArea = document.getElementById('roof-area');
        const wallsPrice = document.getElementById('walls-price');
        const wallsArea = document.getElementById('walls-area');
        const floorPrice = document.getElementById('floor-price');
        const floorArea = document.getElementById('floor-area');
        
        const roofResult = document.getElementById('roof-result');
        const wallsResult = document.getElementById('walls-result');
        const floorResult = document.getElementById('floor-result');
        const totalResult = document.getElementById('total-result');
        
        const roofBar = document.getElementById('roof-bar');
        const wallsBar = document.getElementById('walls-bar');
        const floorBar = document.getElementById('floor-bar');
        
        const saveBtn = document.getElementById('save-calculation');
        const exportBtn = document.getElementById('export-excel');
        const saveModal = document.getElementById('save-modal');
        const closeModal = document.getElementById('close-modal');
        const exportOnlyBtn = document.getElementById('export-only');
        const saveAndExportBtn = document.getElementById('save-and-export');
        const estimateName = document.getElementById('estimate-name');
        const estimateDate = document.getElementById('estimate-date');
        
        // –ü–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥—É –¥–∞—Ç–∏
        const today = new Date().toISOString().split('T')[0];
        estimateDate.value = today;
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∏—Å–µ–ª —É –≥—Ä–æ—à–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç
        function formatCurrency(value) {
            return value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$& ') + ' –≥—Ä–Ω';
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∏—Å–µ–ª –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        function formatNumber(value) {
            return value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$& ');
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ
        function calculateCosts() {
            // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
            const rPrice = parseFloat(roofPrice.value) || 0;
            const rArea = parseFloat(roofArea.value) || 0;
            const wPrice = parseFloat(wallsPrice.value) || 0;
            const wArea = parseFloat(wallsArea.value) || 0;
            const fPrice = parseFloat(floorPrice.value) || 0;
            const fArea = parseFloat(floorArea.value) || 0;
            
            // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å
            const roofCost = rPrice * rArea;
            const wallsCost = wPrice * wArea;
            const floorCost = fPrice * fArea;
            const totalCost = roofCost + wallsCost + floorCost;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
            roofResult.textContent = formatCurrency(roofCost);
            wallsResult.textContent = formatCurrency(wallsCost);
            floorResult.textContent = formatCurrency(floorCost);
            totalResult.textContent = formatCurrency(totalCost);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–æ–≤–ø—á–∏–∫–æ–≤—É –¥—ñ–∞–≥—Ä–∞–º—É
            updateVisualization(roofCost, wallsCost, floorCost, totalCost);
            
            return {
                roof: { price: rPrice, area: rArea, cost: roofCost },
                walls: { price: wPrice, area: wArea, cost: wallsCost },
                floor: { price: fPrice, area: fArea, cost: floorCost },
                total: totalCost
            };
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó
        function updateVisualization(roof, walls, floor, total) {
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
            const maxValue = Math.max(roof, walls, floor, 1);
            const scale = 200 / maxValue; // 200px - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞
            
            roofBar.style.height = (roof * scale) + 'px';
            wallsBar.style.height = (walls * scale) + 'px';
            floorBar.style.height = (floor * scale) + 'px';
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ–≤–ø—Ü—è—Ö
            roofBar.querySelector('.cost-bar-value').textContent = formatNumber(roof);
            wallsBar.querySelector('.cost-bar-value').textContent = formatNumber(walls);
            floorBar.querySelector('.cost-bar-value').textContent = formatNumber(floor);
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤ Excel
        function exportToExcel() {
            const data = calculateCosts();
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–±–æ—á—É –∫–Ω–∏–≥—É
            const wb = XLSX.utils.book_new();
            
            // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
            const wsData = [
                ["–ö–û–®–¢–û–†–ò–° –ë–£–î–Ü–í–ï–õ–¨–ù–ò–• –ú–ê–¢–ï–†–Ü–ê–õ–Ü–í"],
                ["–ù–∞–∑–≤–∞ –∫–æ—à—Ç–æ—Ä–∏—Å—É:", estimateName.value || "–ë–µ–∑ –Ω–∞–∑–≤–∏"],
                ["–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:", estimateDate.value],
                [], // –ü—É—Å—Ç–∏–π —Ä—è–¥–æ–∫
                ["–¢–∏–ø —Ä–æ–±—ñ—Ç", "–¶—ñ–Ω–∞ –∑–∞ –º¬≤ (–≥—Ä–Ω)", "–ü–ª–æ—â–∞ (–º¬≤)", "–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)"],
                [
                    "–ü–æ–∫—Ä—ñ–≤–ª—è (–¥–∞—Ö)", 
                    data.roof.price, 
                    data.roof.area, 
                    data.roof.cost
                ],
                [
                    "–°—Ç—ñ–Ω–∏ (—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞)", 
                    data.walls.price, 
                    data.walls.area, 
                    data.walls.cost
                ],
                [
                    "–ü—ñ–¥–ª–æ–≥–∞", 
                    data.floor.price, 
                    data.floor.area, 
                    data.floor.cost
                ],
                [],
                ["–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å", "", "", data.total]
            ];
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ–±–æ—á–∏–π –∞—Ä–∫—É—à
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // –î–æ–¥–∞—î–º–æ –∞—Ä–∫—É—à –¥–æ –∫–Ω–∏–≥–∏
            XLSX.utils.book_append_sheet(wb, ws, "–ö–æ—à—Ç–æ—Ä–∏—Å");
            
            // –§–æ—Ä–º–∞—Ç—É—î–º–æ –∫–æ–º—ñ—Ä–∫–∏
            if (!ws['!merges']) ws['!merges'] = [];
            ws['!merges'].push({s: {r: 0, c: 0}, e: {r: 0, c: 3}});
            ws['!merges'].push({s: {r: 1, c: 1}, e: {r: 1, c: 3}});
            ws['!merges'].push({s: {r: 2, c: 1}, e: {r: 2, c: 3}});
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É
            const fileName = `–∫–æ—à—Ç–æ—Ä–∏—Å_${estimateName.value || '–±–µ–∑_–Ω–∞–∑–≤–∏'}_${estimateDate.value}.xlsx`;
            
            // –ó–∞–ø–∏—Å—É—î–º–æ —Ñ–∞–π–ª
            XLSX.writeFile(wb, fileName);
        }
        
        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('input', calculateCosts);
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        saveBtn.addEventListener('click', function() {
            saveModal.style.display = 'flex';
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –µ–∫—Å–ø–æ—Ä—Ç—É
        exportBtn.addEventListener('click', function() {
            exportToExcel();
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        closeModal.addEventListener('click', function() {
            saveModal.style.display = 'none';
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏" —É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
        exportOnlyBtn.addEventListener('click', function() {
            exportToExcel();
            saveModal.style.display = 'none';
        });
        
        // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏"
        saveAndExportBtn.addEventListener('click', function() {
            // –¢—É—Ç –±—É–¥–µ –ª–æ–≥—ñ–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
            alert('–ö–æ—à—Ç–æ—Ä–∏—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ!');
            exportToExcel();
            saveModal.style.display = 'none';
        });
        
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—Ä–∏ –∫–ª—ñ–∫—É –∑–∞ –π–æ–≥–æ –º–µ–∂–∞–º–∏
        window.addEventListener('click', function(e) {
            if (e.target === saveModal) {
                saveModal.style.display = 'none';
            }
        });
        
        // –í–∏–∫–æ–Ω—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
        calculateCosts();
    </script>
</body>
</html>